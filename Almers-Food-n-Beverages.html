<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Almer‚Äôs Food n Beverages</title>

  <!-- Library -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <style>
    :root {
      --primary: #002B5B;
      --secondary: #F77F00;
      --light: #f6f9fc;
      --text: #333;
    }

    body {
      font-family: "Poppins", sans-serif;
      background: var(--light);
      color: var(--text);
      margin: 0;
      padding: 0;
    }

    header {
      background: var(--primary);
      color: white;
      text-align: center;
      padding: 15px 10px;
      box-shadow: 0 3px 6px rgba(0,0,0,0.25);
    }

    header img {
      width: 90px;
      height: 90px;
      border-radius: 50%;
      display: block;
      margin: 0 auto 10px;
      border: 3px solid var(--secondary);
      object-fit: cover;
      background: white;
    }

    header h1 {
      font-size: 1.4rem;
      margin: 0;
      letter-spacing: 1px;
      color: var(--secondary);
    }

    main {
      padding: 20px;
      max-width: 1000px;
      margin: auto;
    }

    .card {
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.08);
      padding: 18px;
      margin-bottom: 20px;
    }

    .menu {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 16px;
    }

    button {
      background: var(--secondary);
      color: white;
      font-size: 1.05em;
      border: none;
      border-radius: 10px;
      padding: 14px;
      cursor: pointer;
      transition: transform .15s ease, background .15s ease;
      font-weight: 700;
    }

    button:hover { transform: scale(1.03); background: #e56e00; }

    input {
      width: 100%;
      padding: 10px;
      margin: 6px 0;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 1em;
      box-sizing: border-box;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 8px;
      font-size: 0.95em;
    }

    th, td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: left;
    }

    th {
      background: var(--primary);
      color: #fff;
      font-weight: 700;
    }

    .delete-btn {
      background: #d00000;
      color: white;
      border: none;
      padding: 6px 10px;
      border-radius: 6px;
      cursor: pointer;
    }

    .saldo {
      text-align: center;
      font-size: 1.15em;
      font-weight: 700;
      color: var(--primary);
      margin-top: 14px;
    }

    .hidden { display: none; }

    .whatsapp-float {
      position: fixed;
      width: 58px;
      height: 58px;
      bottom: 18px;
      right: 18px;
      background-color: #25D366;
      color: white;
      border-radius: 50%;
      text-align: center;
      font-size: 28px;
      box-shadow: 2px 2px 6px rgba(0,0,0,0.25);
      z-index: 999;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    footer { text-align:center; color:#666; font-size:0.85rem; margin: 30px 0; }
  </style>
</head>
<body>

  <header>
    <img src="logo-almers.png" alt="Logo Almer's Food n Beverages">
    <h1>Almer‚Äôs Food n Beverages</h1>
  </header>

  <main>
    <section id="dashboard" class="card">
      <h2>Dashboard</h2>
      <div class="menu">
        <button onclick="showPage('pembelian')">üõí Pembelian</button>
        <button onclick="showPage('penjualan')">üç± Penjualan</button>
        <button onclick="showPage('saldo')">üí∞ Saldo</button>
        <button onclick="showPage('laporan')">üìä Laporan</button>
      </div>
    </section>

    <section id="pembelian" class="card hidden">
      <h2>üõí Pembelian Bahan</h2>
      <input id="bahan" placeholder="Nama bahan" />
      <input id="hargaBahan" type="number" placeholder="Harga (Rp)" />
      <button onclick="tambahBahan()">Tambah</button>
      <table id="tabelBahan"><tr><th>Tanggal</th><th>Nama</th><th>Harga</th><th>Aksi</th></tr></table>
      <p><b>Total:</b> Rp <span id="totalBeli">0</span></p>
      <button onclick="back()">‚¨Ö Kembali</button>
    </section>

    <section id="penjualan" class="card hidden">
      <h2>üç± Penjualan</h2>
      <input id="produk" placeholder="Nama produk" />
      <input id="hargaJual" type="number" placeholder="Harga satuan (Rp)" />
      <input id="qty" type="number" placeholder="Quantity (Jumlah)" />
      <button onclick="tambahJual()">Tambah</button>
      <table id="tabelJual"><tr><th>Tanggal</th><th>Produk</th><th>Harga</th><th>Qty</th><th>Total</th><th>Aksi</th></tr></table>
      <p><b>Total:</b> Rp <span id="totalJual">0</span></p>
      <button onclick="back()">‚¨Ö Kembali</button>
    </section>

    <section id="saldo" class="card hidden">
      <h2>üí∞ Saldo</h2>
      <input id="tambahSaldo" type="number" placeholder="Tambah saldo (Rp)" />
      <button onclick="tambahSaldoManual()">Tambah Saldo</button>
      <div class="saldo">Saldo Sekarang: Rp <span id="saldoNow">0</span></div>
      <table id="tabelRiwayat"><tr><th>Tanggal</th><th>Saldo</th><th>Aksi</th></tr></table>
      <button onclick="back()">‚¨Ö Kembali</button>
    </section>

    <section id="laporan" class="card hidden">
      <h2>üìä Laporan</h2>
      <input type="date" id="filterTanggal" onchange="renderLaporan()" />
      <table id="tabelLaporan"><tr><th>Tanggal</th><th>Jenis</th><th>Nama</th><th>Jumlah (Rp)</th></tr></table>
      <p>
        <b>Total Pembelian:</b> Rp <span id="lapBeli">0</span><br>
        <b>Total Penjualan:</b> Rp <span id="lapJual">0</span><br>
        <b>Laba Bersih:</b> Rp <span id="lapLaba">0</span>
      </p>
      <button onclick="exportExcel()">üì§ Ekspor Excel</button>
      <button onclick="exportPDF()">üñ®Ô∏è Ekspor PDF</button>
      <button onclick="back()">‚¨Ö Kembali</button>
    </section>
  </main>

  <a href="https://wa.me/6282330079002" target="_blank" class="whatsapp-float"><i class="fab fa-whatsapp"></i></a>

  <footer>&copy; <span id="tahunNow"></span> Almer‚Äôs Food n Beverages</footer>

<script>
  let pembelian = JSON.parse(localStorage.getItem("pembelian")) || [];
  let penjualan = JSON.parse(localStorage.getItem("penjualan")) || [];
  let saldo = parseInt(localStorage.getItem("saldo")) || 0;
  let riwayatSaldo = JSON.parse(localStorage.getItem("riwayatSaldo")) || [];

  const simpanData = () => {
    localStorage.setItem("pembelian", JSON.stringify(pembelian));
    localStorage.setItem("penjualan", JSON.stringify(penjualan));
    localStorage.setItem("saldo", saldo);
    localStorage.setItem("riwayatSaldo", JSON.stringify(riwayatSaldo));
  };

  const formatRupiah = n => (Number(n) || 0).toLocaleString("id-ID");
  const tgl = () => {
    const d = new Date();
    return `${String(d.getDate()).padStart(2,'0')}/${String(d.getMonth()+1).padStart(2,'0')}/${d.getFullYear()}`;
  };

  document.getElementById("tahunNow").innerText = new Date().getFullYear();

  function showPage(id) {
    document.querySelectorAll("section").forEach(s=>s.classList.add("hidden"));
    document.getElementById(id).classList.remove("hidden");
    render();
  }

  function back() {
    document.querySelectorAll("section").forEach(s=>s.classList.add("hidden"));
    document.getElementById("dashboard").classList.remove("hidden");
  }

  // === Pembelian ===
  function tambahBahan() {
    const nama=document.getElementById("bahan").value;
    const harga=parseInt(document.getElementById("hargaBahan").value);
    if(!nama||!harga)return alert("Lengkapi data!");
    pembelian.push({nama,harga,tanggal:tgl()});
    saldo-=harga; simpanData(); catat(); render();
    document.getElementById("bahan").value=""; document.getElementById("hargaBahan").value="";
  }

  function renderPembelian() {
    const t=document.getElementById("tabelBahan");
    t.innerHTML="<tr><th>Tanggal</th><th>Nama</th><th>Harga</th><th>Aksi</th></tr>";
    let total=0;
    pembelian.forEach((x,i)=>{
      const r=t.insertRow(); r.insertCell(0).innerText=x.tanggal;
      r.insertCell(1).innerText=x.nama; r.insertCell(2).innerText="Rp "+formatRupiah(x.harga);
      const aksi=r.insertCell(3); const btn=document.createElement("button");
      btn.className="delete-btn"; btn.innerText="üóëÔ∏è"; btn.onclick=()=>hapusBeli(i);
      aksi.appendChild(btn); total+=x.harga;
    });
    document.getElementById("totalBeli").innerText=formatRupiah(total);
  }

  function hapusBeli(i){if(!confirm("Hapus data ini?"))return; saldo+=pembelian[i].harga; pembelian.splice(i,1); simpanData();catat();render();}

  // === Penjualan ===
  function tambahJual(){
    const nama=document.getElementById("produk").value;
    const harga=parseInt(document.getElementById("hargaJual").value);
    const qty=parseInt(document.getElementById("qty").value);
    if(!nama||!harga||!qty)return alert("Lengkapi semua!");
    const total=harga*qty; penjualan.push({nama,harga,qty,tanggal:tgl()});
    saldo+=total; simpanData(); catat(); render();
    document.getElementById("produk").value=""; document.getElementById("hargaJual").value=""; document.getElementById("qty").value="";
  }

  function renderPenjualan(){
    const t=document.getElementById("tabelJual");
    t.innerHTML="<tr><th>Tanggal</th><th>Produk</th><th>Harga</th><th>Qty</th><th>Total</th><th>Aksi</th></tr>";
    let total=0;
    penjualan.forEach((x,i)=>{
      const totalItem=x.harga*x.qty;
      const r=t.insertRow(); r.insertCell(0).innerText=x.tanggal;
      r.insertCell(1).innerText=x.nama; r.insertCell(2).innerText="Rp "+formatRupiah(x.harga);
      r.insertCell(3).innerText=x.qty; r.insertCell(4).innerText="Rp "+formatRupiah(totalItem);
      const aksi=r.insertCell(5); const btn=document.createElement("button");
      btn.className="delete-btn"; btn.innerText="üóëÔ∏è"; btn.onclick=()=>hapusJual(i,totalItem);
      aksi.appendChild(btn); total+=totalItem;
    });
    document.getElementById("totalJual").innerText=formatRupiah(total);
  }

  function hapusJual(i,totalItem){if(!confirm("Hapus data ini?"))return; saldo-=totalItem; penjualan.splice(i,1); simpanData();catat();render();}

  // === Saldo ===
  function tambahSaldoManual(){
    const n=parseInt(document.getElementById("tambahSaldo").value);
    if(!n)return alert("Isi nominal!");
    saldo+=n; simpanData(); catat(); render();
    document.getElementById("tambahSaldo").value="";
  }

  function renderSaldo(){
    document.getElementById("saldoNow").innerText=formatRupiah(saldo);
    const t=document.getElementById("tabelRiwayat");
    t.innerHTML="<tr><th>Tanggal</th><th>Saldo</th><th>Aksi</th></tr>";
    riwayatSaldo.slice().reverse().forEach((x,i)=>{
      const r=t.insertRow();
      r.insertCell(0).innerText=x.tanggal;
      r.insertCell(1).innerText="Rp "+formatRupiah(x.saldo);
      const aksi=r.insertCell(2);
      const btn=document.createElement("button");
      btn.className="delete-btn"; btn.innerText="üóëÔ∏è";
      btn.onclick=()=>hapusRiwayat(riwayatSaldo.length-1-i);
      aksi.appendChild(btn);
    });
  }

  function hapusRiwayat(i){if(!confirm("Hapus riwayat ini?"))return; riwayatSaldo.splice(i,1); simpanData(); renderSaldo();}

  function catat(){
    const t=tgl();
    const idx=riwayatSaldo.findIndex(r=>r.tanggal===t);
    if(idx>=0)riwayatSaldo[idx].saldo=saldo; else riwayatSaldo.push({tanggal:t,saldo});
    simpanData();
  }

  // === Laporan ===
  function renderLaporan(){
    const f=document.getElementById("filterTanggal").value;
    const t=document.getElementById("tabelLaporan");
    t.innerHTML="<tr><th>Tanggal</th><th>Jenis</th><th>Nama</th><th>Jumlah (Rp)</th></tr>";
    let totalB=0,totalJ=0;
    const all=[...pembelian.map(x=>({...x,jenis:"Pembelian"})),...penjualan.map(x=>({...x,jenis:"Penjualan"}))];
    all.forEach(x=>{
      if(f){
        const [d,m,y]=x.tanggal.split("/");
        const iso=`${y}-${m.padStart(2,'0')}-${d.padStart(2,'0')}`;
        if(f!==iso)return;
      }
      const r=t.insertRow();
      r.insertCell(0).innerText=x.tanggal;
      r.insertCell(1).innerText=x.jenis;
      r.insertCell(2).innerText=x.nama;
      r.insertCell(3).innerText="Rp "+formatRupiah(x.jenis==="Penjualan"?(x.harga*x.qty):x.harga);
      if(x.jenis==="Penjualan")totalJ+=(x.harga*x.qty); else totalB+=x.harga;
    });
    document.getElementById("lapBeli").innerText=formatRupiah(totalB);
    document.getElementById("lapJual").innerText=formatRupiah(totalJ);
    document.getElementById("lapLaba").innerText=formatRupiah(totalJ-totalB);
  }

  function exportExcel(){
    const wb=XLSX.utils.table_to_book(document.getElementById("tabelLaporan"));
    XLSX.writeFile(wb,"Laporan_Almers.xlsx");
  }

  function exportPDF(){
    const {jsPDF}=window.jspdf;
    const doc=new jsPDF();
    doc.text("Laporan Almer‚Äôs Food n Beverages",14,15);
    doc.autoTable({html:"#tabelLaporan",startY:25});
    doc.save("Laporan_Almers.pdf");
  }

  function render() {
  renderPembelian();
  renderPenjualan();
  renderSaldo();
  renderLaporan();
}

// Jalankan otomatis ketika halaman sudah dimuat
document.addEventListener("DOMContentLoaded", () => {
  render();
  console.log("‚úÖ Aplikasi Almer‚Äôs Food n Beverages siap digunakan!");
});
</script>
</body>
</html>
